<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">

        <script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
         <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.2/d3.min.js" charset="utf-8"></script>
        <!--<script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>-->
        <script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
        <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
        <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
         <link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.min.css" rel="stylesheet">
        <script src="js/streamgraph.js" type="text/javascript"></script>
        <script src="js/progressBar.js" type="text/javascript"></script>
        <link href="build/nv.d3.css" rel="stylesheet" type="text/css">
        <script src="build/nv.d3.js"></script>
        <script src="js/crossfilter.v1.min.js"></script>
        <!--<script src="js/popcorn-1.2.js"></script>
        <script type="text/javascript" src="js/popcorn.js"></script>-->

        <style>
            body {
                font: 10px sans-serif;
                margin-top:50px;
            }
            #chart { 
                background: #fff;

            }
            #chart .remove {
              position: relative !important;
            }
            #chart1{
                margin-top:50px;
                height: 450px;
            }
            p {
                font: 12px helvetica;
            }
            .axis path, .axis line {
                fill: none;
                stroke: #fff;
                stroke-width: 2px;
                shape-rendering: crispEdges;
            }
            #bar-chart .tick{
                display:none;
            }
            button {
                right: 50px;
                top: 10px;
            }
      .cs-navbar {
                background-color: #F3913B;
                border-bottom:0;
                color: white;
            }
            .cs-navbar .navbar-brand {
                color: white;
                font-size: 10px;
            }
            #displayList{
                margin-top:10px;
                border:0;
                width:40%;
                height:220px;
                font-size: 12px;
            }
            .btn{
               
                  margin: -20px 10px 0px 10px;
            }
            #ourvideo{
                width:40%;
            }
             p#subtitle-50{
                  margin-left: 455px;
                    font-size: 15px;
            }
            .axis text {
  font: 10px sans-serif;
}

.brush rect.extent {
  fill: steelblue;
  fill-opacity: .125;
}

.brush .resize path {
  fill: #eee;
  stroke: #666;
}

#hour-chart {
  width: 260px;
}

#delay-chart {
  width: 230px;
}

#distance-chart {
  width: 420px;
}

#date-chart {
  width: 920px;
}

#flight-list {
  min-height: 1024px;
}

#flight-list .date,
#flight-list .day {
  margin-bottom: .4em;
}

#flight-list .flight {
  line-height: 1.5em;
  background: #eee;
  width: 640px;
  margin-bottom: 1px;
}

#flight-list .time {
  color: #999;
}

#flight-list .flight div {
  display: inline-block;
  width: 100px;
}

#flight-list div.distance,
#flight-list div.delay {
  width: 160px;
  padding-right: 10px;
  text-align: right;
}

#flight-list .early {
  color: green;
}

aside {
  position: absolute;
  left: 740px;
  font-size: smaller;
  width: 220px;
}




      
        </style>
    </head>
    <body>

  <div class="navbar navbar-fixed-top navbar-inverse cs-navbar">
    <div class="navbar-inner">
      <div class="container">
        <a href="#" class="navbar-brand cs-brand"><i class="icon-bar-chart icon-medium"> <strong>EmotionWatch</strong></i></a>
      </div>
    </div>
  </div>

<div class="container">
    <header class="cs-header">
      <h1><i class="icon-bar-chart icon-medium"></i> EmotionWatch</h1>
      <p>Indexing Movies through Emotions. Discover the relationship between sentiment and plot shape in movies</p>
      <p></p>  

        <div class="pull-right">
            <select class="form-control" id="movie-list">
        <form>

  <!-- <label><input type="radio" name="mode" value="grouped"> Grouped</label>
  <label><input type="radio" name="mode" value="stacked" checked> Stacked</label> -->
</form>


            </select>
        </div>

    </header>

<style>

.menu:hover{ 
    font-size:16px;
    font-weight: bolder;
   
    cursor:pointer;
text-shadow: 0 0 0.2em #fff, 0 0 0.2em #fff, 0 0 0.2em #fff, 0 0 0.2em #fff, 0 0 0.2em #fff, 0 0 0.2em #fff, 0 0 0.2em #fff, 0 0 0.2em #fff, 0 0 0.2em #fff, 0 0 0.2em #fff, 0 0 0.2em #fff, 0 0 0.2em #fff
}

</style>
<script>
function draw(data) {

use="strict"

var width = 1000,
    height = 1000;
    posicionY = 0;

var svg = d3.select("body")
          svg.append('svg')

            .attr('width', width)
            .attr('height', height)

            




                    .selectAll('text')
                    .data(data)
                    .enter()
                    .append('text')
                    .text(function(d) {return d.pais.toUpperCase()})
                    .attr('class',"menu")
                    .attr('x', 80)
                    .attr('y', function(d, i) {return (i * 7)+30})
                    .attr("id",function(d, i) {return (i * 7)+30})
                    .attr("font-family", "sans-serif")
                    .attr("font-size", "6px")
                   
                 
                    function cambio(valor,fond){
                        svg.selectAll('path')
                        .transition()
                        .delay(100)
                        .duration(500)
                        .attr("d","M230,170 C240,"+valor+" 460,"+valor+" 470,170")
                        .attr("fill", "none")
                        .attr("stroke-linecap","round")

                        svg.selectAll('rect')
                        .attr("y",fond)
                    }


                    d3.select('svg')
                    .append("text")
                    .text("VISUALIZING THE WORLD HAPPINESS INDEX, 2013")
                    .attr("x", 10)
                    .attr("y", 10)
                   
               .attr("font-family", "sans-serif")
                    .attr("font-size", "10px")
                    .attr("fill", "#D3D3D3")
    


   

svg.selectAll('text')
    .on('mouseover', function(d){

cambio(Number(d.porcentaje)*(3.25),(this.id))

    posicionY = this.id;


d3.select("text#hola_id").remove();
                
                

                d3.select('svg')
                    .append("text")
                    .text(Number(d.indice)/1000)
                    .attr("x", 50)
                    .attr("y", posicionY)
                    .attr("id", "hola_id")
               .attr("font-family", "sans-serif")
                    .attr("font-size", "10px")
                    .attr("font-weight","bold")


})
    .on('mouseout', function(d){
d3.select("text#hola_id").remove();
cambio(170,(this.id))


})



/*
            d3.select('svg')
            .append("circle")
            .attr('r',160)
            .attr('cx',350)
            .attr('cy',170)
            .attr('fill',"white")


            d3.select('svg')
            .append("circle")
            .attr('r',15)
            .attr('cx',50)
            .attr('cy',15)
            .attr('fill',"#cfcfcf")

d3.select('svg')
            .append("circle")
            .attr('r',15)
            .attr('cx',50)
            .attr('cy',600)
            .attr('fill',"#cfcfcf")
            */

        d3.select('svg')
            .append("path")
            .attr("id","animo")
            .attr("d","M230,170 C240,170 460,170 470,170")
            .style("stroke-width", 4)
            .style("stroke", "black")
            .attr("fill", "none")
            .attr("stroke-linecap","round")



    d3.select('svg')
            .append("circle")
            .attr('r',3)
            .attr('cx',220)
            .attr('cy',170)
            .attr('fill',"black")

            d3.select('svg')
            .append("circle")
            .attr('r',3)
            .attr('cx',480)
            .attr('cy',170)
            .attr('fill',"black")


}

</script>

    <script>
        d3.json('data/felicidad.json',draw);
    </script>





  <div class="input-group">
                    <input type="text" id="search"  class="form-control" placeholder="Search" name="q" onkeyup="searchWord()">
                    <div class="input-group-btn">
                        <button class="btn btn-default" type="submit"><i class="glyphicon glyphicon-search"></i></button>
                    </div>
                </div>

     <div><select name="displayList" id="displayList" multiple="multiple" size="10"></select>
 <!--<iframe id="movie-video" width="460" height="215" src="https://www.youtube.com/embed/OiTiKOy59o4" frameborder="0" allowfullscreen></iframe>-->

   <video id="ourvideo" poster="gravity.jpg" autobuffer controls>
                <source src="http://statecs.com/DH2321/project4/gravity.ogv">
            </video>
            <div id="infoWrapper"></div>


                        
   </div>
      </div>

        <select name="lineList" id="lineList"></select>

  

<div id="charts">
  <div id="hour-chart" class="chart">
    <div class="title">Time of Day</div>
  </div>
  <div id="delay-chart" class="chart">
    <div class="title">Arrival Delay (min.)</div>
  </div>
  <div id="distance-chart" class="chart">
    <div class="title">Distance (mi.)</div>
  </div>
  <div id="date-chart" class="chart">
    <div class="title">Date</div>
  </div>
</div>

<aside id="totals"><span id="active">-</span> of <span id="total">-</span> flights selected.</aside>

<div id="lists">
  <div id="flight-list" class="list"></div>
</div>


    <script type="text/javascript">
      
      // Initialize lists of lines
      var jsonFile;
      var lineList = document.getElementById('lineList');
            lineList.style.visibility = 'hidden';
            var displayList = document.getElementById('displayList');
            updateList();
      var vid = document.getElementById("ourvideo");
      
      // Code to jump to time-offset in video when selected
      $("#displayList").on('change', function(){
        var timestamp = $(this).val().toString().split(":");
        var offset = parseInt((timestamp[0] * 3600)) + parseInt((timestamp[1] * 60)) + parseInt((timestamp[2]));
        vid.currentTime = offset;
      });
      
      // Code that automatically highlights option in searchbar based on timestamp
      vid.addEventListener('timeupdate',function(event){
        var currentTime = vid.currentTime;
        var hour = Math.floor(currentTime/3600);
        currentTime = currentTime % 3600;
        var minute = Math.floor(currentTime / 60);
        currentTime = currentTime % 60;
        var second = Math.floor(currentTime);
        var value = padZero(hour) + ":" + padZero(minute) + ":" + padZero(second);
        //console.log(value);
        setOption(value);
      },false);
      
      
      // Helper code to pad zeroes
      function padZero(number) {
        if (number<=10) { number = ("0"+number).slice(-2); }
        return number;
      }
      
      // Helper code to select an option
            function setOption(value) {
        var options = displayList.options;
        for (var i = 0, optionsLength = options.length; i < optionsLength; i++) {
          if (options[i].value == value) {
            displayList.selectedIndex = i;
            return true;
          }
        }
        return false;
      }
            
      // Code that updates list of lines when movie is changed.
            function updateList(movieTitle) {
        // Defensive code, loads default values
                displayList.options.length = 0;
                lineList.options.length = 0;
                if (movieTitle == null || movieTitle.length < 0) {
                    movieTitle = "json/Gravity.json";
                }
                
                else {
                    movieTitle = movieTitle.split(".")[0];
                    movieTitle = "json/" + movieTitle + ".json";

                }
        
        // Populates dummy/base with lines from JSON file (hidden to user)
                $.getJSON(movieTitle,{}, function(response) {
                    jsonFile = response;
                    selector = $("#lineList");
                    for(var key in jsonFile){
                        if(jsonFile.hasOwnProperty(key)){
                            var line = jsonFile[key];
              var timeVal = line["timestamp"].substring(0,line["timestamp"].indexOf(","));
                            selector.append("<option value="+timeVal+">"+timeVal + " - " + line["sentence"]+"</option>");
                        }
                    }
                });
        
        // Populates actual list that is displayed to user
                $.getJSON(movieTitle,{}, function(response) {
                    jsonFile = response;
                    selector = $("#displayList");
                    for(var key in jsonFile){
                        if(jsonFile.hasOwnProperty(key)){
                            var line = jsonFile[key];
              var timeVal = line["timestamp"].substring(0,line["timestamp"].indexOf(","));
                            selector.append("<option value="+timeVal+">"+timeVal + " - " + line["sentence"]+"</option>");
                        }
                    }
                });
            }


       
         function searchWord(){
        // Searches for words in base list, and updates display list with hits.
                var searchvalue= document.getElementById('search').value;
                searchvalue = searchvalue.toLowerCase();
                var from_s = document.getElementById('lineList');
                var displayList = document.getElementById('displayList');
                displayList.options.length = 0;
                for (var i=0;i<from_s.options.length-1;i++) {
                    var str=from_s.options[i].text;
                    var st = str.toLowerCase();
                    if(st.search(searchvalue)>-1) {
                        var val = from_s.options[i].value;
                        var newRow = new Option(str, val);
                        displayList.add(newRow);
                    }            
                }
        
        // Automatically highlight first line as default
                if (searchvalue.length > 0) {
                    $("#displayList").val($("#displayList option:first").val());
                }
            }

       

    </script>
    </div>


      
    
                
<div class="clear-fix"></div>
            <div id="bar-chart"></div>

            <!--<div id="progress-bar">
                <script type="text/javascript">progressBar("data/Gravity.csv", "orange")</script>
            </div>-->
                <svg id="chart1"></svg>
           <!-- <div id="chart"> 
                <script type="text/javascript">
                    chart("data/mock.csv", "orange");
                </script>
            </div>-->

         

        
    </body>
    <script type="text/javascript">
        $.getJSON("json/movieList.json", function (json) {
            selector = $("#movie-list");
            for(var key in json){
                if(json.hasOwnProperty(key)){
                    var movie =json[key];
                    selector.append("<option value="+movie["file"]+"-"+movie["color"]+"-"+movie["video"]+">"+key+"</option>");
                }
            }
        })
        $("#movie-list").on('change', function(){
            var newMovie = $(this).val().split("-");
            barChart("data/"+newMovie[0]);
            $("#movie-video").attr("src", newMovie[2]);
            updateList(newMovie[0]);
        });

    </script>


<style>

.menu:hover{ 
    font-size:16px;
    font-weight: bolder;
   
    cursor:pointer;
text-shadow: 0 0 0.2em #fff, 0 0 0.2em #fff, 0 0 0.2em #fff, 0 0 0.2em #fff, 0 0 0.2em #fff, 0 0 0.2em #fff, 0 0 0.2em #fff, 0 0 0.2em #fff, 0 0 0.2em #fff, 0 0 0.2em #fff, 0 0 0.2em #fff, 0 0 0.2em #fff
}




</style>

    <script type="text/javascript" src="d3.js"></script>

<script>

function draw(data) {

use="strict"

var width = 1000,
    height = 1000;
    posicionY = 0;

var svg = d3.select("body")
          svg.append('svg')

            .attr('width', width)
            .attr('height', height)

            




                    .selectAll('text')
                    .data(data)
                    .enter()
                    .append('text')
                    .text(function(d) {return d.pais.toUpperCase()})
                    .attr('class',"menu")
                    .attr('x', 80)
                    .attr('y', function(d, i) {return (i * 7)+30})
                    .attr("id",function(d, i) {return (i * 7)+30})
                    .attr("font-family", "sans-serif")
                    .attr("font-size", "6px")
                   
                 
                    function cambio(valor,fond){
                        svg.selectAll('path')
                        .transition()
                        .delay(100)
                        .duration(500)
                        .attr("d","M230,170 C240,"+valor+" 460,"+valor+" 470,170")
                        .attr("fill", "none")
                        .attr("stroke-linecap","round")

                        svg.selectAll('rect')
                        .attr("y",fond)
                    }


                    d3.select('svg')
                    .append("text")
                    .text("VISUALIZING THE WORLD HAPPINESS INDEX, 2013")
                    .attr("x", 10)
                    .attr("y", 10)
                   
               .attr("font-family", "sans-serif")
                    .attr("font-size", "10px")
                    .attr("fill", "#D3D3D3")
    


   

svg.selectAll('text')
    .on('mouseover', function(d){

cambio(Number(d.porcentaje)*(3.25),(this.id))

    posicionY = this.id;


d3.select("text#hola_id").remove();
                
                

                d3.select('svg')
                    .append("text")
                    .text(Number(d.indice)/1000)
                    .attr("x", 50)
                    .attr("y", posicionY)
                    .attr("id", "hola_id")
               .attr("font-family", "sans-serif")
                    .attr("font-size", "10px")
                    .attr("font-weight","bold")


})
    .on('mouseout', function(d){
d3.select("text#hola_id").remove();
cambio(170,(this.id))


})



/*
            d3.select('svg')
            .append("circle")
            .attr('r',160)
            .attr('cx',350)
            .attr('cy',170)
            .attr('fill',"white")


            d3.select('svg')
            .append("circle")
            .attr('r',15)
            .attr('cx',50)
            .attr('cy',15)
            .attr('fill',"#cfcfcf")

d3.select('svg')
            .append("circle")
            .attr('r',15)
            .attr('cx',50)
            .attr('cy',600)
            .attr('fill',"#cfcfcf")
            */

        d3.select('svg')
            .append("path")
            .attr("id","animo")
            .attr("d","M230,170 C240,170 460,170 470,170")
            .style("stroke-width", 4)
            .style("stroke", "black")
            .attr("fill", "none")
            .attr("stroke-linecap","round")



    d3.select('svg')
            .append("circle")
            .attr('r',3)
            .attr('cx',220)
            .attr('cy',170)
            .attr('fill',"black")

            d3.select('svg')
            .append("circle")
            .attr('r',3)
            .attr('cx',480)
            .attr('cy',170)
            .attr('fill',"black")


}

</script>

    <script>
        d3.json('data/felicidad.json',draw);
    </script>



</script>

        <script src="js/stackedarea.js" type="text/javascript"></script>
        <script src="js/barchart.js" type="text/javascript"></script>
        <script type="text/javascript">
            // stackedArea("data/Gravity.csv");
            barChart("data/Gravity.csv");
        </script>


</html>