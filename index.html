<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <script src="http://d3js.org/d3.v2.js"></script>
        <script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
        <script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
        <script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
        <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
        <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
        <script src="js/streamgraph.js" type="text/javascript"></script>
        <script src="js/progressBar.js" type="text/javascript"></script>
        <style>
            body {
                font: 10px sans-serif;
            }
            #chart { 
                background: #fff;
            }
            p {
                font: 12px helvetica;
            }
            .axis path, .axis line {
                fill: none;
                stroke: #000;
                stroke-width: 2px;
                shape-rendering: crispEdges;
            }
            button {
                position: absolute;
                right: 50px;
                top: 10px;
            }
			
			
        </style>
    </head>
    <body>
		<div>
		<!-- HTML for SEARCH BAR -->
		Search<input type="text"  id="search" onkeyup="searchWord()"/>
		<br />

		 <select name="displayList" id="displayList" multiple="multiple" size="10"></select>
        <select name="lineList" id="lineList"</select>

		
		<script type="text/javascript">
			var jsonFile;
			var lineList = document.getElementById('lineList');
            lineList.style.visibility = 'hidden';
            var displayList = document.getElementById('displayList');
            updateList();
            
            
            function updateList(movieTitle) {
                displayList.options.length = 0;
                lineList.options.length = 0;
                if (movieTitle == null || movieTitle.length < 0) {
                    movieTitle = "json/Gravity.json";
                }
                
                else {
                    movieTitle = movieTitle.split(".")[0];
                    movieTitle = "json/" + movieTitle + ".json";

                }
                            $.getJSON(movieTitle,{}, function(response) {
                    jsonFile = response;
                    selector = $("#lineList");
                    for(var key in jsonFile){
                        if(jsonFile.hasOwnProperty(key)){
                            var line = jsonFile[key];
                            selector.append("<option value="+line["timestamp"]+" - "+line["sentence"]+"</option>");
                        }
                    }
                });
                $.getJSON(movieTitle,{}, function(response) {
                    jsonFile = response;
                    selector = $("#displayList");
                    for(var key in jsonFile){
                        if(jsonFile.hasOwnProperty(key)){
                            var line = jsonFile[key];
                            selector.append("<option value="+line["timestamp"]+" - "+line["sentence"]+"</option>");
                        }
                    }
                });
            }


			 
         function searchWord(){

                var searchvalue= document.getElementById('search').value;
                searchvalue = searchvalue.toLowerCase();
                var from_s = document.getElementById('lineList');
                var displayList = document.getElementById('displayList');
                displayList.options.length = 0;
                for (var i=0;i<from_s.options.length-1;i++) {
                    var str=from_s.options[i].text;
                    var st = str.toLowerCase();
                    if(st.search(searchvalue)>-1) {
                        var val = from_s.options[i].value;
                        var newRow = new Option(str, val);
                        displayList.add(newRow);
                    }            
                }
                if (searchvalue.length > 0) {
                    $("#displayList").val($("#displayList option:first").val());
                }
            }

			 

		</script>
		</div>
		
        <div class="pull-right">
            <select class="form-control" id="movie-list">
            </select>
        </div>
   
        <center>
            <iframe id="movie-video" width="560" height="315" src="https://www.youtube.com/embed/OiTiKOy59o4" frameborder="0" allowfullscreen></iframe>
            <div id="progress-bar">
                <script type="text/javascript">progressBar("data/Gravity.csv", "orange")</script>
            </div>
            <div id="chart"> 
                <script type="text/javascript">
                    chart("data/mock.csv", "orange");
                </script>
            </div>

        </center>
    </body>
    <script type="text/javascript">
        $.getJSON("json/movieList.json", function (json) {
            selector = $("#movie-list");
            for(var key in json){
                if(json.hasOwnProperty(key)){
                    var movie =json[key];
                    selector.append("<option value="+movie["file"]+"-"+movie["color"]+"-"+movie["video"]+">"+key+"</option>");
                }
            }
        })
        $("#movie-list").on('change', function(){
            var newMovie = $(this).val().split("-");
            chart("data/"+newMovie[0], newMovie[1]);
            $("#movie-video").attr("src", newMovie[2]);
            updateList(newMovie[0]);
        });

    </script>
</html>